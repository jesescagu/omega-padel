<ui:composition template="/WEB-INF/plantilla/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="content">

		<h:form id="detalleAnuncio">

			<h:panelGroup layout="block" styleClass="container-fluid">

				<h:panelGroup styleClass="row">
					<h:panelGroup styleClass="col-sm-6">

						<h:panelGroup styleClass="row">
							<p:commandButton value="Editar" styleClass="col-sm-3"
								rendered="#{anuncioController.estaEmpleadoLogado}"
								action="#{anuncioController.editarAnuncio(anuncioController.anuncioSeleccionado)}" />

							<p:commandButton value="Desactivar" styleClass="col-sm-3"
								rendered="#{anuncioController.estaEmpleadoLogado and anuncioController.anuncioSeleccionado.activo eq true}"
								action="#{anuncioController.desactivarAnuncio(anuncioController.anuncioSeleccionado)}" />

							<p:commandButton value="Activar" styleClass="col-sm-3"
								rendered="#{anuncioController.estaEmpleadoLogado and anuncioController.anuncioSeleccionado.activo eq false}"
								action="#{anuncioController.activarAnuncio(anuncioController.anuncioSeleccionado)}" />

						</h:panelGroup>

						<h:panelGroup styleClass="row">

							<p:galleria widgetVar="galleriaWidget" panelWidth="500"
								panelHeight="350" effectSpeed="1000" autoPlay="true"
								transitionInterval="3000"
								value="#{anuncioController.imagenesAMostrarDelAnuncio}"
								var="elem">

								<h:graphicImage value="data:image/jpg;base64,#{elem}"
									alt="Description" title="#{elem}" width="500" height="350" />

								<f:facet name="thumbnail">
									<h:graphicImage value="data:image/jpg;base64,#{elem}" />
								</f:facet>
							</p:galleria>

						</h:panelGroup>

						<h:panelGroup styleClass="row">


							<br />

							<h1>
								<h:outputText value="Comentarios" />
							</h1>

							<h:panelGroup rendered="#{anuncioController.estaClienteLogado}"
								layout="block" styleClass="container-fluid">

								<h:messages errorStyle="color:red;" globalOnly="true" />

								<br />

								<div class="row">
									<p:outputLabel styleClass="col-sm-2"
										for="tituloNuevoComentario" value="Título" />
									<p:inputText id="tituloNuevoComentario" styleClass="col-sm-9" maxlength="150"
										value="#{anuncioController.nuevoTituloComentario}" />
								</div>

								<div class="row">
									<p:outputLabel styleClass="col-sm-2"
										for="descripcionNuevoComentario" value="Descripción" />
									<p:inputTextarea rows="5" id="descripcionNuevoComentario"
										styleClass="col-sm-9" maxlength="500"
										value="#{anuncioController.nuevaDescripcionComentario}" />
								</div>

								<div class="row">
									<p:outputLabel styleClass="col-sm-2"
										for="calificacionNuevoComentario" value="Calificación" />
									<p:rating styleClass="col-sm-2" style="padding:0px;"
										id="calificacionNuevoComentario"
										value="#{anuncioController.nuevaCalificacionComentario}" />

								</div>

								<br />

								<div class="row">
									<div class="col-sm-6">
										<p:commandButton value="Guardar" update="@all"
											action="#{anuncioController.guardarComentario(anuncioController.anuncioSeleccionado)}" />
									</div>

								</div>
							</h:panelGroup>

							<h:panelGroup id="grupoTablaComentarios" styleClass="row">

								<h:panelGroup styleClass="col-12">


									<p:dataTable
										value="#{anuncioController.listaComentariosAnuncio}"
										emptyMessage="Actualmente no existen comentarios del producto"
										var="coment">

										<p:column width="25%" style="text-align:center" headerText="Título">
											<h:outputText value="#{coment.titulo}" />
										</p:column>

										<p:column width="35%" style="text-align:center" headerText="Descripción">
											<h:outputText value="#{coment.descripcion}" />
										</p:column>

										<p:column  width="20%" style="text-align:center" headerText="Calificación">
											<p:rating readonly="true" value="#{coment.calificacion}" />
										</p:column>

										<p:column  width="20%" rendered="#{anuncioController.estaEmpleadoLogado}"
											style="text-align:center" headerText="Acciones">
											<p:commandButton styleClass="btn btn-primary" process="@this" update=":detalleAnuncio:grupoTablaComentarios"
												actionListener="#{anuncioController.eliminarComentario(coment)}"
												value="Eliminar">
											</p:commandButton>
										</p:column>

									</p:dataTable>



								</h:panelGroup>

							</h:panelGroup>


						</h:panelGroup>



					</h:panelGroup>
					<h:panelGroup style="background-color:#fafaf4;border:solid;"
						styleClass="col-sm-6">

						<h:panelGroup styleClass="row">
							<h1>
								<h:outputText
									value="#{anuncioController.anuncioSeleccionado.titulo}" />
							</h1>
						</h:panelGroup>

						<hr />

						<h:panelGroup styleClass="row">

							<h:outputText styleClass="col-sm-3"
								style="font-size:2em;font-weight: bold;color:red;"
								value="#{anuncioController.anuncioSeleccionado.precio} €" />
							<p:commandButton styleClass="col-sm-7" process="@this" update="@all"
								disabled="#{anuncioController.estaClienteLogado eq false}"
								actionListener="#{cestaController.addAnuncioAlCarrito(anuncioController.anuncioSeleccionado)}"
								value="Añadir al carrito" />
							<p:staticMessage styleClass="col-sm-12"
								rendered="#{anuncioController.estaClienteLogado eq false}"
								severity="warn"
								detail="Inicie sesión para comprar este producto."
								style="width: 100%" />
						</h:panelGroup>

						<hr />

						<h:panelGroup styleClass="row">
							<h4>
								<p:outputLabel for="notaMediaAnuncio" value="Media de opiniones" />
							</h4>

							<p:rating readonly="true" id="notaMediaAnuncio"
								value="#{anuncioController.notaMedia(anuncioController.anuncioSeleccionado)}" />
						</h:panelGroup>

						<hr />

						<h:panelGroup styleClass="row">
							<h:outputText escape="false"
								value="#{anuncioController.anuncioSeleccionado.descripcion}" />
						</h:panelGroup>

					</h:panelGroup>
				</h:panelGroup>

			</h:panelGroup>
		</h:form>

	</ui:define>
</ui:composition>