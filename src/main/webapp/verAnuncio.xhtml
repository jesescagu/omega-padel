<ui:composition template="/WEB-INF/plantilla/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="content">

		<h:form id="detalleAnuncio">

			<h:panelGroup layout="block" styleClass="container-fluid">

				<h:panelGroup styleClass="row">
					<h:panelGroup styleClass="col-sm-6">

						<h:panelGroup styleClass="row">
							<p:commandButton value="Editar" styleClass="col-sm-3"
								rendered="#{anuncioController.estaEmpleadoLogado}"
								action="#{anuncioController.editarAnuncio(anuncioController.anuncioSeleccionado)}" />

							<p:commandButton value="Desactivar" styleClass="col-sm-3"
								rendered="#{anuncioController.estaEmpleadoLogado and anuncioController.anuncioSeleccionado.activo eq true}"
								action="#{anuncioController.desactivarAnuncio(anuncioController.anuncioSeleccionado)}" />

							<p:commandButton value="Activar" styleClass="col-sm-3"
								rendered="#{anuncioController.estaEmpleadoLogado and anuncioController.anuncioSeleccionado.activo eq false}"
								action="#{anuncioController.activarAnuncio(anuncioController.anuncioSeleccionado)}" />

						</h:panelGroup>

						<h:panelGroup styleClass="row">

							<p:carousel id="imagenesAnuncios"
								rendered="#{anuncioController.imagenesAMostrarDelAnuncio.size() ne 1}"
								value="#{anuncioController.imagenesAMostrarDelAnuncio}"
								var="elem" numVisible="1" numScroll="1" circular="true"
								effect="slide" style="max-width: 640px" autoplayInterval="5000">
								<h:graphicImage width="100%" style="width: 100%"
									value="data:image/jpg;base64,#{elem}" />
							</p:carousel>

							<h:graphicImage width="100%" style="max-width: 640px"
								rendered="#{anuncioController.imagenesAMostrarDelAnuncio.size() eq 1}"
								value="data:image/jpg;base64,#{anuncioController.imagenesAMostrarDelAnuncio.get(0)}" />

						</h:panelGroup>

						<h:panelGroup styleClass="row">


							<br />

							<h1>
								<h:outputText value="Comentarios" />
							</h1>

							<h:panelGroup rendered="#{anuncioController.estaClienteLogado}"
								layout="block" styleClass="container-fluid">

								<h:messages errorStyle="color:red;" globalOnly="true" />

								<br />

								<div class="row">
									<p:outputLabel styleClass="col-sm-2"
										for="tituloNuevoComentario" value="Título" />
									<p:inputText id="tituloNuevoComentario" styleClass="col-sm-9"
										maxlength="150"
										value="#{anuncioController.nuevoTituloComentario}" />
								</div>

								<div class="row">
									<p:outputLabel styleClass="col-sm-2"
										for="descripcionNuevoComentario" value="Descripción" />
									<p:inputTextarea rows="5" id="descripcionNuevoComentario"
										styleClass="col-sm-9" maxlength="500"
										value="#{anuncioController.nuevaDescripcionComentario}" />
								</div>

								<div class="row">
									<p:outputLabel styleClass="col-sm-2"
										for="calificacionNuevoComentario" value="Calificación" />
									<p:rating styleClass="col-sm-2" style="padding:0px;"
										id="calificacionNuevoComentario"
										value="#{anuncioController.nuevaCalificacionComentario}" />

								</div>

								<br />

								<div class="row">
									<div class="col-sm-6">
										<p:commandButton value="Guardar" update="@all"
											action="#{anuncioController.guardarComentario(anuncioController.anuncioSeleccionado)}" />
									</div>

								</div>
							</h:panelGroup>

							<h:panelGroup id="grupoTablaComentarios" styleClass="row">

								<h:panelGroup styleClass="col-12">


									<p:dataTable widgetVar="tablaComentarios" allowUnsorting="true"
										sortMode="single" rows="5" paginator="true"
										paginatorPosition="bottom" paginatorAlwaysVisible="false"
										rowsPerPageTemplate="5,10,20,30,{ShowAll|'Todo'}"
										paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
										value="#{anuncioController.listaComentariosAnuncio}"
										emptyMessage="Actualmente no existen comentarios del producto"
										var="coment">

										<p:column width="25%" style="text-align:center"
											headerText="Título">
											<h:outputText value="#{coment.titulo}" />
										</p:column>

										<p:column width="35%" style="text-align:center"
											headerText="Descripción">
											<h:outputText value="#{coment.descripcion}" />
										</p:column>

										<p:column sortBy="#{coment.calificacion}"
											filterMatchMode="exact" filterBy="#{coment.calificacion}"
											width="20%" style="text-align:center"
											headerText="Calificación">

											<f:facet name="filter">
												<p:selectOneMenu onchange="PF('tablaComentarios').filter()"
													styleClass="custom-filter">
													<f:selectItem itemLabel="Todo" itemValue="#{null}"
														noSelectionOption="true" />
													<f:selectItem itemLabel="1 estrella" itemValue="1" />
													<f:selectItem itemLabel="2 estrella" itemValue="2" />
													<f:selectItem itemLabel="3 estrella" itemValue="3" />
													<f:selectItem itemLabel="4 estrella" itemValue="4" />
													<f:selectItem itemLabel="5 estrella" itemValue="5" />
												</p:selectOneMenu>
											</f:facet>

											<p:rating readonly="true" value="#{coment.calificacion}" />
										</p:column>

										<p:column width="20%"
											rendered="#{anuncioController.estaEmpleadoLogado}"
											style="text-align:center" headerText="Acciones">
											<p:commandButton styleClass="btn btn-primary" process="@this"
												update=":detalleAnuncio:grupoTablaComentarios"
												actionListener="#{anuncioController.eliminarComentario(coment)}"
												value="Eliminar">
											</p:commandButton>
										</p:column>
									</p:dataTable>
								</h:panelGroup>
							</h:panelGroup>
						</h:panelGroup>

					</h:panelGroup>
					<h:panelGroup style="background-color:#fafaf4;border:solid;"
						styleClass="col-sm-6">

						<h:panelGroup styleClass="row">
							<h1>
								<h:outputText
									value="#{anuncioController.anuncioSeleccionado.titulo}" />
							</h1>
						</h:panelGroup>

						<hr />

						<h:panelGroup
							rendered="#{anuncioController.renderUnicaTallaZapatillaRopa()}"
							styleClass="row">

							<p:outputLabel styleClass="col-sm-6" for="selectTalla" value="Selecciona talla del producto" />
							
							<p:selectOneMenu id="selectTalla" styleClass="col-sm-6"
								value="#{anuncioController.tallaSeleccionadaDeProducto}">
								<p:ajax event="change" process="@this" />

								<f:selectItem itemLabel="Selecciona talla" />
								<f:selectItems var="temp" itemLabel="#{temp}"
									itemValue="#{temp}"
									value="#{anuncioController.getTallasProductosUnica(anuncioController.anuncioSeleccionado.productos.get(0))}" />
							</p:selectOneMenu>

						</h:panelGroup>
						<h:panelGroup
							rendered="#{anuncioController.renderListaTallasProducto()}"
							styleClass="row">

							<p:dataTable var="elem" id="tablaTallas"
								value="#{anuncioController.tallasProductoDeAnuncioSeleccionado.keySet()}">

								<p:column headerText="Producto">

									<h:outputText value="#{elem.marca.nombre} #{elem.modelo}" />

								</p:column>

								<p:column headerText="Talla">
									<h:panelGroup
										rendered="#{elem['class'].simpleName eq 'Pala' or elem['class'].simpleName eq 'Pelota' or elem['class'].simpleName eq 'Paletero'}">
										<h:outputText styleClass="col-sm-3" value="Unica" />
									</h:panelGroup>

									<h:panelGroup
										rendered="#{elem['class'].simpleName eq 'Zapatilla' or elem['class'].simpleName eq 'Ropa'}">

										<p:selectOneMenu styleClass="col-sm-6"
											rendered="#{anuncioController.renderModificarTallaProductoLista(elem) eq false}"
											value="#{anuncioController.tallaSeleccionadaDeProducto}">
											<p:ajax event="change" process="@this" />

											<f:selectItem itemLabel="Selecciona talla" />
											<f:selectItems var="temp" itemLabel="#{temp}"
												itemValue="#{temp}"
												value="#{anuncioController.getTallasProductosUnica(elem)}" />
										</p:selectOneMenu>

										<p:selectOneMenu styleClass="col-sm-6" disabled="true"
											rendered="#{anuncioController.renderModificarTallaProductoLista(elem) eq true}"
											value="#{anuncioController.tallasProductoDeAnuncioSeleccionado.get(elem)}">

											<f:selectItem itemLabel="Selecciona talla" />
											<f:selectItems var="temp" itemLabel="#{temp}"
												itemValue="#{temp}"
												value="#{anuncioController.getTallasProductosUnica(elem)}" />
										</p:selectOneMenu>

									</h:panelGroup>
								</p:column>

								<p:column headerText="Acciones">

									<p:commandButton styleClass="btn btn-primary" process="@this"
										update=":detalleAnuncio:tablaTallas"
										rendered="#{anuncioController.renderModificarTallaProductoLista(elem)}"
										actionListener="#{anuncioController.renderCambiaValorTalla(elem)}"
										value="Elegir talla">
									</p:commandButton>

									<p:commandButton styleClass="btn btn-primary" process="@this"
										update=":detalleAnuncio:tablaTallas"
										rendered="#{anuncioController.renderModificarTallaProductoLista(elem) eq false}"
										actionListener="#{anuncioController.cambiaValorTalla(elem)}"
										value="Guardar">
									</p:commandButton>
								</p:column>
							</p:dataTable>
						</h:panelGroup>
						
						<br/>

						<h:panelGroup styleClass="row">

							<h:outputText styleClass="col-sm-3"
								style="font-size:2em;font-weight: bold;color:red;"
								value="#{anuncioController.anuncioSeleccionado.precio} €" />
							<p:commandButton styleClass="col-sm-7" process="@this"
								update="@all"
								disabled="#{anuncioController.estaClienteLogado eq false}"
								actionListener="#{anuncioController.addAnuncioAlCarrito()}"
								value="Añadir al carrito" />
							<p:staticMessage styleClass="col-sm-12"
								rendered="#{anuncioController.estaClienteLogado eq false}"
								severity="warn"
								detail="Inicie sesión para comprar este producto."
								style="width: 100%" />
						</h:panelGroup>

						<hr />

						<h:panelGroup styleClass="row">
							<h4>
								<p:outputLabel for="notaMediaAnuncio" value="Media de opiniones" />
							</h4>

							<p:rating readonly="true" id="notaMediaAnuncio"
								value="#{anuncioController.notaMedia(anuncioController.anuncioSeleccionado)}" />
						</h:panelGroup>

						<hr />

						<h:panelGroup styleClass="row">
							<h:outputText escape="false"
								value="#{anuncioController.anuncioSeleccionado.descripcion}" />
						</h:panelGroup>

					</h:panelGroup>
				</h:panelGroup>

			</h:panelGroup>
		</h:form>

	</ui:define>
</ui:composition>